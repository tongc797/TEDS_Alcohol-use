---
#code for Chen, T., Oginni, O. A., Hannigan, L. J., Eley, T. C., Maggs, J. L., Linden-Carmichael, A. N., & Neiderhiser, J. M.. Developmental trajectories of child and adolescent emotional problems: Associations with early adult alcohol use behaviors.
author: "Tong Chen"
#script for piecewise LGC models and alcohol use prediction
---
  
#setting up
rm(list=ls())
library("lavaan")
library("psych")
library("tidyverse")
library("foreign")
library("polycor")

#read data
TEDS <- read.spss("538 Tong Chen SDQ and alcohol version 2 Oct2022_analysis.sav", use.value.labels =FALSE,to.data.frame=TRUE)
options(max.print=10000)

#select cases
TEDS<-subset(TEDS, (exclude1 == 0))
TEDS<-subset(TEDS, (is.na(emo41) == 0)|(is.na(gpsanxt1) == 0)|(is.na(ipsanxt1) == 0)|(is.na(icsanxt1) == 0)|(is.na(lcsdqemot1) == 0)|(is.na(pcbhsdqemot1) == 0)|(is.na(dsdcont1) == 0)|(is.na(gpscont1) == 0)|(is.na(ipscont1) == 0)|(is.na(icscont1) == 0)|(is.na(lcsdqcont1) == 0)|(is.na(pcbhsdqcont1) == 0)|(is.na(u2calcoaudit1) == 0))

#Piecewise latent growth curve models

#basic model with covariance among age 9 parent and self reports
#warning: latent variable cov matrix non-positive definite
LGCmodel1<-'
IEC=~1*emo41+1*gpsanxt1+1*ipsanxt1
SEC=~0*emo41+0.3*gpsanxt1+0.5*ipsanxt1
IEA=~1*icsanxt1+1*lcsdqemot1+1*pcbhsdqemot1
SEA=~0*icsanxt1+0.22*lcsdqemot1+0.73*pcbhsdqemot1
ICC=~1*dsdcont1+1*gpscont1+1*ipscont1
SCC=~0*dsdcont1+0.3*gpscont1+0.5*ipscont1
ICA=~1*icscont1+1*lcsdqcont1+1*pcbhsdqcont1
SCA=~0*icscont1+0.22*lcsdqcont1+0.73*pcbhsdqcont1
ipsanxt1~~icsanxt1
ipscont1~~icscont1
' 
LGCmodel1<-cfa(LGCmodel1,data=TEDS,estimator="MLR",missing='ML',cluster="randomfamid",meanstructure=TRUE)
summary(LGCmodel1,standardized=T,fit.measures=T)

#add residual correlation of emotional and conduct of the same age, good fit now
LGCmodel2<-'
IEC=~1*emo41+1*gpsanxt1+1*ipsanxt1
SEC=~0*emo41+0.3*gpsanxt1+0.5*ipsanxt1
IEA=~1*icsanxt1+1*lcsdqemot1+1*pcbhsdqemot1
SEA=~0*icsanxt1+0.22*lcsdqemot1+0.73*pcbhsdqemot1
ICC=~1*dsdcont1+1*gpscont1+1*ipscont1
SCC=~0*dsdcont1+0.3*gpscont1+0.5*ipscont1
ICA=~1*icscont1+1*lcsdqcont1+1*pcbhsdqcont1
SCA=~0*icscont1+0.22*lcsdqcont1+0.73*pcbhsdqcont1
ipsanxt1~~icsanxt1
ipscont1~~icscont1
emo41~~dsdcont1
gpsanxt1~~gpscont1
ipsanxt1~~ipscont1+icscont1
icsanxt1~~ipscont1+icscont1
lcsdqemot1~~lcsdqcont1
pcbhsdqemot1~~pcbhsdqcont1
' 
LGCmodel2<-cfa(LGCmodel2,data=TEDS,estimator="MLR",missing='ML',cluster="randomfamid",meanstructure=TRUE)
summary(LGCmodel2,standardized=T,fit.measures=T)

#constrain residuals, separately for childhood and adolescence
LGCmodel3<-'
IEC=~1*emo41+1*gpsanxt1+1*ipsanxt1
SEC=~0*emo41+0.3*gpsanxt1+0.5*ipsanxt1
IEA=~1*icsanxt1+1*lcsdqemot1+1*pcbhsdqemot1
SEA=~0*icsanxt1+0.22*lcsdqemot1+0.73*pcbhsdqemot1
ICC=~1*dsdcont1+1*gpscont1+1*ipscont1
SCC=~0*dsdcont1+0.3*gpscont1+0.5*ipscont1
ICA=~1*icscont1+1*lcsdqcont1+1*pcbhsdqcont1
SCA=~0*icscont1+0.22*lcsdqcont1+0.73*pcbhsdqcont1
ipsanxt1~~icsanxt1
ipscont1~~icscont1
emo41~~dsdcont1
gpsanxt1~~gpscont1
ipsanxt1~~ipscont1+icscont1
icsanxt1~~ipscont1+icscont1
lcsdqemot1~~lcsdqcont1
pcbhsdqemot1~~pcbhsdqcont1
emo41~~re1*emo41
gpsanxt1~~re1*gpsanxt1
ipsanxt1~~re1*ipsanxt1
icsanxt1~~re2*icsanxt1
lcsdqemot1~~re2*lcsdqemot1
pcbhsdqemot1~~re2*pcbhsdqemot1
dsdcont1~~rc1*dsdcont1
gpscont1~~rc1*gpscont1
ipscont1~~rc1*ipscont1
icscont1~~rc2*icscont1
lcsdqcont1~~rc2*lcsdqcont1
pcbhsdqcont1~~rc2*pcbhsdqcont1
'
LGCmodel3<-cfa(LGCmodel3,data=TEDS,estimator="MLR",missing='ML',cluster="randomfamid",meanstructure=TRUE)
summary(LGCmodel3,standardized=T,fit.measures=T)
anova(LGCmodel2,LGCmodel3) #sig

#add means of latent variables. poor model fit
LGCmodel4<-'
IEC=~1*emo41+1*gpsanxt1+1*ipsanxt1
SEC=~0*emo41+0.3*gpsanxt1+0.5*ipsanxt1
IEA=~1*icsanxt1+1*lcsdqemot1+1*pcbhsdqemot1
SEA=~0*icsanxt1+0.22*lcsdqemot1+0.73*pcbhsdqemot1
ICC=~1*dsdcont1+1*gpscont1+1*ipscont1
SCC=~0*dsdcont1+0.3*gpscont1+0.5*ipscont1
ICA=~1*icscont1+1*lcsdqcont1+1*pcbhsdqcont1
SCA=~0*icscont1+0.22*lcsdqcont1+0.73*pcbhsdqcont1
ipsanxt1~~icsanxt1
ipscont1~~icscont1
emo41~~dsdcont1
gpsanxt1~~gpscont1
ipsanxt1~~ipscont1+icscont1
icsanxt1~~ipscont1+icscont1
lcsdqemot1~~lcsdqcont1
pcbhsdqemot1~~pcbhsdqcont1
emo41~0*1
gpsanxt1~0*1
ipsanxt1~0*1
icsanxt1~0*1
lcsdqemot1~0*1
pcbhsdqemot1~0*1
dsdcont1~0*1
gpscont1~0*1
ipscont1~0*1
icscont1~0*1
lcsdqcont1~0*1
pcbhsdqcont1~0*1
IEC~1
SEC~1
IEA~1
SEA~1
ICC~1
SCC~1
ICA~1
SCA~1
' 
LGCmodel4<-cfa(LGCmodel4,data=TEDS,estimator="MLR",missing='ML',cluster="randomfamid",meanstructure=TRUE)
summary(LGCmodel4,standardized=T,fit.measures=T)
anova(LGCmodel2,LGCmodel4) #sig

#add quadratic slope then specify means structure with latent growth factors 
#exactly same fit as LGCmodel2
LGCmodel5<-'
IEC=~1*emo41+1*gpsanxt1+1*ipsanxt1
SEC=~0*emo41+0.3*gpsanxt1+0.5*ipsanxt1
QEC=~0*emo41+0.09*gpsanxt1+0.25*ipsanxt1
IEA=~1*icsanxt1+1*lcsdqemot1+1*pcbhsdqemot1
SEA=~0*icsanxt1+0.22*lcsdqemot1+0.73*pcbhsdqemot1
QEA=~0*icsanxt1+0.05*lcsdqemot1+0.53*pcbhsdqemot1
ICC=~1*dsdcont1+1*gpscont1+1*ipscont1
SCC=~0*dsdcont1+0.3*gpscont1+0.5*ipscont1
QCC=~0*dsdcont1+0.09*gpscont1+0.25*ipscont1
ICA=~1*icscont1+1*lcsdqcont1+1*pcbhsdqcont1
SCA=~0*icscont1+0.22*lcsdqcont1+0.73*pcbhsdqcont1
QCA=~0*icscont1+0.05*lcsdqcont1+0.53*pcbhsdqcont1
ipsanxt1~~icsanxt1
ipscont1~~icscont1
emo41~~dsdcont1
gpsanxt1~~gpscont1
ipsanxt1~~ipscont1+icscont1
icsanxt1~~ipscont1+icscont1
lcsdqemot1~~lcsdqcont1
pcbhsdqemot1~~pcbhsdqcont1
emo41~0*1
gpsanxt1~0*1
ipsanxt1~0*1
icsanxt1~0*1
lcsdqemot1~0*1
pcbhsdqemot1~0*1
dsdcont1~0*1
gpscont1~0*1
ipscont1~0*1
icscont1~0*1
lcsdqcont1~0*1
pcbhsdqcont1~0*1
IEC~1
SEC~1
IEA~1
SEA~1
ICC~1
SCC~1
ICA~1
SCA~1
QEC~1
QEA~1
QCC~1
QCA~1
QEC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QEA+0*QCC+0*QCA
QEA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCC+0*QCA
QCC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCA
QCA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA
QEC~~0*QEC
QEA~~0*QEA
QCC~~0*QCC
QCA~~0*QCA
' 
LGCmodel5<-cfa(LGCmodel5,data=TEDS,estimator="MLR",missing='ML',cluster="randomfamid",meanstructure=TRUE)
summary(LGCmodel5,standardized=T,fit.measures=T)

#constrain non-significant covariance based on LGCmodel5
#everything non-sig can be constrained to 0 except SEC~~ICC, so added back
LGCmodel5a<-'
ipsanxt1~~icsanxt1
emo41~~dsdcont1
gpsanxt1~~gpscont1
ipsanxt1~~ipscont1
icsanxt1~~icscont1
lcsdqemot1~~lcsdqcont1
ipsanxt1~~icscont1
IEC~~0*SEC+0*SCC
SEC~~0*SEA+0*SCC+0*SCA
IEA~~0*SCC
SEA~~0*SCC
IEC=~1*emo41+1*gpsanxt1+1*ipsanxt1
SEC=~0*emo41+0.3*gpsanxt1+0.5*ipsanxt1
QEC=~0*emo41+0.09*gpsanxt1+0.25*ipsanxt1
IEA=~1*icsanxt1+1*lcsdqemot1+1*pcbhsdqemot1
SEA=~0*icsanxt1+0.22*lcsdqemot1+0.73*pcbhsdqemot1
QEA=~0*icsanxt1+0.05*lcsdqemot1+0.53*pcbhsdqemot1
ICC=~1*dsdcont1+1*gpscont1+1*ipscont1
SCC=~0*dsdcont1+0.3*gpscont1+0.5*ipscont1
QCC=~0*dsdcont1+0.09*gpscont1+0.25*ipscont1
ICA=~1*icscont1+1*lcsdqcont1+1*pcbhsdqcont1
SCA=~0*icscont1+0.22*lcsdqcont1+0.73*pcbhsdqcont1
QCA=~0*icscont1+0.05*lcsdqcont1+0.53*pcbhsdqcont1
emo41~0*1
gpsanxt1~0*1
ipsanxt1~0*1
icsanxt1~0*1
lcsdqemot1~0*1
pcbhsdqemot1~0*1
dsdcont1~0*1
gpscont1~0*1
ipscont1~0*1
icscont1~0*1
lcsdqcont1~0*1
pcbhsdqcont1~0*1
IEC~1
SEC~1
IEA~1
SEA~1
ICC~1
SCC~1
ICA~1
SCA~1
QEC~1
QEA~1
QCC~1
QCA~1
QEC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QEA+0*QCC+0*QCA
QEA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCC+0*QCA
QCC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCA
QCA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA
QEC~~0*QEC
QEA~~0*QEA
QCC~~0*QCC
QCA~~0*QCA
' 
LGCmodel5a<-cfa(LGCmodel5a,data=TEDS,estimator="MLR",missing='ML',cluster="randomfamid",meanstructure=TRUE)
summary(LGCmodel5a,standardized=T,fit.measures=T)
anova(LGCmodel5,LGCmodel5a)#non-sig

#save latent factor scores 
idx <- lavInspect(LGCmodel5a, "case.idx")
fscores <- lavPredict(LGCmodel5a,method="Regression")
## loop over factors
for (fs in colnames(fscores)) {
  TEDS[idx, fs] <- fscores[ , fs]
}

write.csv(TEDS,"~/TEDS data analysis/TEDSfac.csv", row.names = TRUE)

#predict alcohol use
#add alcohol use as outcome, without covariates
ALCmodel1<-'
ipsanxt1~~icsanxt1
emo41~~dsdcont1
gpsanxt1~~gpscont1
ipsanxt1~~ipscont1
icsanxt1~~icscont1
lcsdqemot1~~lcsdqcont1
ipsanxt1~~icscont1
IEC~~0*SEC+0*SCC
SEC~~0*SEA+0*SCC+0*SCA
IEA~~0*SCC
SEA~~0*SCC
IEC=~1*emo41+1*gpsanxt1+1*ipsanxt1
SEC=~0*emo41+0.3*gpsanxt1+0.5*ipsanxt1
QEC=~0*emo41+0.09*gpsanxt1+0.25*ipsanxt1
IEA=~1*icsanxt1+1*lcsdqemot1+1*pcbhsdqemot1
SEA=~0*icsanxt1+0.22*lcsdqemot1+0.73*pcbhsdqemot1
QEA=~0*icsanxt1+0.05*lcsdqemot1+0.53*pcbhsdqemot1
ICC=~1*dsdcont1+1*gpscont1+1*ipscont1
SCC=~0*dsdcont1+0.3*gpscont1+0.5*ipscont1
QCC=~0*dsdcont1+0.09*gpscont1+0.25*ipscont1
ICA=~1*icscont1+1*lcsdqcont1+1*pcbhsdqcont1
SCA=~0*icscont1+0.22*lcsdqcont1+0.73*pcbhsdqcont1
QCA=~0*icscont1+0.05*lcsdqcont1+0.53*pcbhsdqcont1
emo41~0*1
gpsanxt1~0*1
ipsanxt1~0*1
icsanxt1~0*1
lcsdqemot1~0*1
pcbhsdqemot1~0*1
dsdcont1~0*1
gpscont1~0*1
ipscont1~0*1
icscont1~0*1
lcsdqcont1~0*1
pcbhsdqcont1~0*1
IEC~1
SEC~1
IEA~1
SEA~1
ICC~1
SCC~1
ICA~1
SCA~1
QEC~1
QEA~1
QCC~1
QCA~1
QEC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QEA+0*QCC+0*QCA
QEA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCC+0*QCA
QCC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCA
QCA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA
QEC~~0*QEC
QEA~~0*QEA
QCC~~0*QCC
QCA~~0*QCA
u2calcoaudit1~IEC+SEC+IEA+SEA+ICC+SCC+ICA+SCA
' 
ALCmodel1<-cfa(ALCmodel1,data=TEDS,estimator="MLR",missing='ML',cluster="randomfamid",meanstructure=TRUE)
summary(ALCmodel1,standardized=T,fit.measures=T)

#add alcohol use as outcome (regressed on age), add all covariates+sex
ALCmodel1_cov<-'
ipsanxt1~~icsanxt1
emo41~~dsdcont1
gpsanxt1~~gpscont1
ipsanxt1~~ipscont1
icsanxt1~~icscont1
lcsdqemot1~~lcsdqcont1
ipsanxt1~~icscont1
IEC~~0*SEC+0*SCC
SEC~~0*SEA+0*SCC+0*SCA
IEA~~0*SCC
SEA~~0*SCC
IEC=~1*emo41+1*gpsanxt1+1*ipsanxt1
SEC=~0*emo41+0.3*gpsanxt1+0.5*ipsanxt1
QEC=~0*emo41+0.09*gpsanxt1+0.25*ipsanxt1
IEA=~1*icsanxt1+1*lcsdqemot1+1*pcbhsdqemot1
SEA=~0*icsanxt1+0.22*lcsdqemot1+0.73*pcbhsdqemot1
QEA=~0*icsanxt1+0.05*lcsdqemot1+0.53*pcbhsdqemot1
ICC=~1*dsdcont1+1*gpscont1+1*ipscont1
SCC=~0*dsdcont1+0.3*gpscont1+0.5*ipscont1
QCC=~0*dsdcont1+0.09*gpscont1+0.25*ipscont1
ICA=~1*icscont1+1*lcsdqcont1+1*pcbhsdqcont1
SCA=~0*icscont1+0.22*lcsdqcont1+0.73*pcbhsdqcont1
QCA=~0*icscont1+0.05*lcsdqcont1+0.53*pcbhsdqcont1
emo41~0*1
gpsanxt1~0*1
ipsanxt1~0*1
icsanxt1~0*1
lcsdqemot1~0*1
pcbhsdqemot1~0*1
dsdcont1~0*1
gpscont1~0*1
ipscont1~0*1
icscont1~0*1
lcsdqcont1~0*1
pcbhsdqcont1~0*1
IEC~1
SEC~1
IEA~1
SEA~1
ICC~1
SCC~1
ICA~1
SCA~1
QEC~1
QEA~1
QCC~1
QCA~1
QEC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QEA+0*QCC+0*QCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QEA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCC+0*QCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QCC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QCA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QEC~~0*QEC
QEA~~0*QEA
QCC~~0*QCC
QCA~~0*QCA
u2calcoauditrage1~IEC+SEC+IEA+SEA+ICC+SCC+ICA+SCA+laethnic+llivs21+lrel21+lstatus21D1+lstatus21D2+lases+lu1chqualp1+lu1pchild1+lsex1
laethnic=~1*aethnic
aethnic~~0*aethnic
llivs21=~1*livs21
livs21~~0*livs21
lrel21=~1*rel21
rel21~~0*rel21
lstatus21D1=~1*status21D1
status21D1~~0*status21D1
lstatus21D2=~1*status21D2
status21D2~~0*status21D2
lases=~1*ases
ases~~0*ases
lu1chqualp1=~1*u1chqualp1
u1chqualp1~~0*u1chqualp1
lu1pchild1=~1*u1pchild1
u1pchild1~~0*u1pchild1
lsex1=~1*sex1
sex1~~0*sex1
' 
ALCmodel1_cov<-cfa(ALCmodel1_cov,data=TEDS,estimator="MLR",missing='ML',cluster="randomfamid",meanstructure=TRUE)
summary(ALCmodel1_cov,standardized=T,fit.measures=T)

#separate AUDIT-C and AUDIT-P
#add alcohol use (AUDIT-C) as outcome (regressed on age), add all covariates+sex
ALCCmodel1_cov<-'
ipsanxt1~~icsanxt1
emo41~~dsdcont1
gpsanxt1~~gpscont1
ipsanxt1~~ipscont1
icsanxt1~~icscont1
lcsdqemot1~~lcsdqcont1
ipsanxt1~~icscont1
IEC~~0*SEC+0*SCC
SEC~~0*SEA+0*SCC+0*SCA
IEA~~0*SCC
SEA~~0*SCC
IEC=~1*emo41+1*gpsanxt1+1*ipsanxt1
SEC=~0*emo41+0.3*gpsanxt1+0.5*ipsanxt1
QEC=~0*emo41+0.09*gpsanxt1+0.25*ipsanxt1
IEA=~1*icsanxt1+1*lcsdqemot1+1*pcbhsdqemot1
SEA=~0*icsanxt1+0.22*lcsdqemot1+0.73*pcbhsdqemot1
QEA=~0*icsanxt1+0.05*lcsdqemot1+0.53*pcbhsdqemot1
ICC=~1*dsdcont1+1*gpscont1+1*ipscont1
SCC=~0*dsdcont1+0.3*gpscont1+0.5*ipscont1
QCC=~0*dsdcont1+0.09*gpscont1+0.25*ipscont1
ICA=~1*icscont1+1*lcsdqcont1+1*pcbhsdqcont1
SCA=~0*icscont1+0.22*lcsdqcont1+0.73*pcbhsdqcont1
QCA=~0*icscont1+0.05*lcsdqcont1+0.53*pcbhsdqcont1
emo41~0*1
gpsanxt1~0*1
ipsanxt1~0*1
icsanxt1~0*1
lcsdqemot1~0*1
pcbhsdqemot1~0*1
dsdcont1~0*1
gpscont1~0*1
ipscont1~0*1
icscont1~0*1
lcsdqcont1~0*1
pcbhsdqcont1~0*1
IEC~1
SEC~1
IEA~1
SEA~1
ICC~1
SCC~1
ICA~1
SCA~1
QEC~1
QEA~1
QCC~1
QCA~1
QEC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QEA+0*QCC+0*QCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QEA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCC+0*QCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QCC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QCA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QEC~~0*QEC
QEA~~0*QEA
QCC~~0*QCC
QCA~~0*QCA
u2calcoauditcrage1~IEC+SEC+IEA+SEA+ICC+SCC+ICA+SCA+laethnic+llivs21+lrel21+lstatus21D1+lstatus21D2+lases+lu1chqualp1+lu1pchild1+lsex1
laethnic=~1*aethnic
aethnic~~0*aethnic
llivs21=~1*livs21
livs21~~0*livs21
lrel21=~1*rel21
rel21~~0*rel21
lstatus21D1=~1*status21D1
status21D1~~0*status21D1
lstatus21D2=~1*status21D2
status21D2~~0*status21D2
lases=~1*ases
ases~~0*ases
lu1chqualp1=~1*u1chqualp1
u1chqualp1~~0*u1chqualp1
lu1pchild1=~1*u1pchild1
u1pchild1~~0*u1pchild1
lsex1=~1*sex1
sex1~~0*sex1
' 
ALCCmodel1_cov<-cfa(ALCCmodel1_cov,data=TEDS,estimator="MLR",missing='ML',cluster="randomfamid",meanstructure=TRUE)
summary(ALCCmodel1_cov,standardized=T,fit.measures=T)

#add alcohol problems (AUDIT-P) as outcome (regressed on age), log transformed, add all covariates+sex
ALCPmodel1_cov<-'
ipsanxt1~~icsanxt1
emo41~~dsdcont1
gpsanxt1~~gpscont1
ipsanxt1~~ipscont1
icsanxt1~~icscont1
lcsdqemot1~~lcsdqcont1
ipsanxt1~~icscont1
IEC~~0*SEC+0*SCC
SEC~~0*SEA+0*SCC+0*SCA
IEA~~0*SCC
SEA~~0*SCC
IEC=~1*emo41+1*gpsanxt1+1*ipsanxt1
SEC=~0*emo41+0.3*gpsanxt1+0.5*ipsanxt1
QEC=~0*emo41+0.09*gpsanxt1+0.25*ipsanxt1
IEA=~1*icsanxt1+1*lcsdqemot1+1*pcbhsdqemot1
SEA=~0*icsanxt1+0.22*lcsdqemot1+0.73*pcbhsdqemot1
QEA=~0*icsanxt1+0.05*lcsdqemot1+0.53*pcbhsdqemot1
ICC=~1*dsdcont1+1*gpscont1+1*ipscont1
SCC=~0*dsdcont1+0.3*gpscont1+0.5*ipscont1
QCC=~0*dsdcont1+0.09*gpscont1+0.25*ipscont1
ICA=~1*icscont1+1*lcsdqcont1+1*pcbhsdqcont1
SCA=~0*icscont1+0.22*lcsdqcont1+0.73*pcbhsdqcont1
QCA=~0*icscont1+0.05*lcsdqcont1+0.53*pcbhsdqcont1
emo41~0*1
gpsanxt1~0*1
ipsanxt1~0*1
icsanxt1~0*1
lcsdqemot1~0*1
pcbhsdqemot1~0*1
dsdcont1~0*1
gpscont1~0*1
ipscont1~0*1
icscont1~0*1
lcsdqcont1~0*1
pcbhsdqcont1~0*1
IEC~1
SEC~1
IEA~1
SEA~1
ICC~1
SCC~1
ICA~1
SCA~1
QEC~1
QEA~1
QCC~1
QCA~1
QEC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QEA+0*QCC+0*QCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QEA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCC+0*QCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QCC~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*QCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QCA~~0*IEC+0*SEC+0*IEA+0*SEA+0*ICC+0*SCC+0*ICA+0*SCA+0*laethnic+0*llivs21+0*lrel21+0*lstatus21D1+0*lstatus21D2+0*lases+0*lu1chqualp1+0*lu1pchild1+0*lsex1
QEC~~0*QEC
QEA~~0*QEA
QCC~~0*QCC
QCA~~0*QCA
u2calcoauditpragelg1~IEC+SEC+IEA+SEA+ICC+SCC+ICA+SCA+laethnic+llivs21+lrel21+lstatus21D1+lstatus21D2+lases+lu1chqualp1+lu1pchild1+lsex1
laethnic=~1*aethnic
aethnic~~0*aethnic
llivs21=~1*livs21
livs21~~0*livs21
lrel21=~1*rel21
rel21~~0*rel21
lstatus21D1=~1*status21D1
status21D1~~0*status21D1
lstatus21D2=~1*status21D2
status21D2~~0*status21D2
lases=~1*ases
ases~~0*ases
lu1chqualp1=~1*u1chqualp1
u1chqualp1~~0*u1chqualp1
lu1pchild1=~1*u1pchild1
u1pchild1~~0*u1pchild1
lsex1=~1*sex1
sex1~~0*sex1
' 
ALCPmodel1_cov<-cfa(ALCPmodel1_cov,data=TEDS,estimator="MLR",missing='ML',cluster="randomfamid",meanstructure=TRUE)
summary(ALCPmodel1_cov,standardized=T,fit.measures=T)